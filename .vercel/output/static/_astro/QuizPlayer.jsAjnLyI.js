import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DiEladB3.js";import{a as C,D as w}from"./types.B1hmS33K.js";function R(r){try{const n=localStorage.getItem(`quiz_${r}`);return n?JSON.parse(n):null}catch{return null}}function S(r,n){try{localStorage.setItem(`quiz_${r}`,JSON.stringify(n))}catch{}}function T({quiz:r,prevSlug:n,nextSlug:x}){const[o,p]=i.useState("UNSOLVED"),[s,u]=i.useState(null),[b,g]=i.useState(!1),[c,f]=i.useState(null),[y,h]=i.useState(!1);i.useEffect(()=>{const a=R(r.slug);a&&(u(a.choice),p(a.result))},[r.slug]);const v=a=>{o==="CORRECT"||o==="WRONG"||(u(a),p("SOLVING"))},N=i.useCallback(async()=>{if(s===null)return;const a=s===r.correctIndex?"CORRECT":"WRONG";p(a);const t={choice:s,result:a,timestamp:Date.now()};S(r.slug,t);try{await fetch("/api/quiz-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quizSlug:r.slug,selectedIndex:s,isCorrect:a==="CORRECT"})})}catch{}try{const l=await fetch(`/api/quiz-stats?slug=${r.slug}`);l.ok&&f(await l.json())}catch{}},[s,r.correctIndex,r.slug]),j=async()=>{const a=`${window.location.origin}/quiz/${r.slug}`,t=`ğŸ§  ë‡Œê°„ì‹ â€” "${r.title}"
${o==="CORRECT"?"âœ… ë§í˜”ìŠµë‹ˆë‹¤!":"ë„ì „í•´ë³´ì„¸ìš”!"}
`;if(navigator.share)try{await navigator.share({title:`ë‡Œê°„ì‹ â€” ${r.title}`,text:t,url:a})}catch{}else await navigator.clipboard.writeText(`${t}${a}`),h(!0),setTimeout(()=>h(!1),2e3)},d=o==="CORRECT"||o==="WRONG",k=C[r.category]||"#6C5CE7";return e.jsxs("article",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold text-white",style:{backgroundColor:k},children:r.category}),e.jsxs("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["â˜…".repeat(r.difficulty),"â˜†".repeat(3-r.difficulty)," ",w[r.difficulty]]}),e.jsx("span",{className:"text-sm text-[var(--color-text-secondary)]",children:r.publishedAt})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-6 leading-relaxed",children:r.question}),e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-label":"ì„ íƒì§€",children:r.choices.map((a,t)=>{let l="w-full text-left px-4 py-4 rounded-xl border-2 transition-all text-base font-medium cursor-pointer min-h-[56px] relative";const m=c?.distribution?.[t]?Math.round(c.distribution[t]/c.total*100):null;return d?t===r.correctIndex?l+=" border-[var(--color-correct)] bg-green-50 dark:bg-green-900/20":t===s&&o==="WRONG"?l+=" border-[var(--color-wrong)] bg-red-50 dark:bg-red-900/20":l+=" border-gray-200 dark:border-gray-700 opacity-50":t===s?l+=" border-[var(--color-primary)] bg-purple-50 dark:bg-purple-900/20 scale-[1.01]":l+=" border-gray-200 dark:border-gray-700 hover:border-[var(--color-primary)] hover:bg-purple-50/30",e.jsxs("button",{role:"radio","aria-checked":t===s,tabIndex:0,onClick:()=>v(t),className:l,disabled:d,children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-8 h-8 rounded-full border-2 border-current flex items-center justify-center text-sm font-bold shrink-0",children:d&&t===r.correctIndex?"âœ“":d&&t===s&&o==="WRONG"?"âœ—":String.fromCharCode(65+t)}),e.jsx("span",{className:"flex-1",children:a}),d&&m!==null&&e.jsxs("span",{className:"text-sm font-bold shrink-0",children:[m,"%"]})]}),d&&m!==null&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 rounded-b-xl transition-all duration-700 ease-out",style:{width:`${m}%`,backgroundColor:t===r.correctIndex?"var(--color-correct)":"var(--color-text-secondary)",opacity:.3}})]},t)})}),o==="SOLVING"&&e.jsx("button",{onClick:N,className:"w-full mt-6 py-4 rounded-xl bg-[var(--color-primary)] text-white font-bold text-lg hover:bg-[var(--color-primary-dark)] transition-colors cursor-pointer min-h-[56px]",children:"ì •ë‹µ í™•ì¸"}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`mt-6 p-5 rounded-xl ${o==="CORRECT"?"bg-green-50 dark:bg-green-900/20 border border-green-200":"bg-red-50 dark:bg-red-900/20 border border-red-200"}`,role:"alert","aria-live":"assertive",children:[e.jsx("p",{className:"font-bold text-xl mb-1",children:o==="CORRECT"?"âœ… ì •ë‹µ!":"âŒ ì•„ì‰¬ì›Œìš”!"}),c&&e.jsxs("p",{className:"text-sm text-[var(--color-text-secondary)]",children:[c.total,"ëª… ì°¸ì—¬ Â· ì •ë‹µë¥  ",Math.round(c.distribution[r.correctIndex]/c.total*100),"%"]})]}),e.jsx("button",{onClick:()=>g(!b),className:"w-full mt-4 py-4 rounded-xl border-2 border-[var(--color-primary)] text-[var(--color-primary)] font-bold hover:bg-purple-50 dark:hover:bg-purple-900/10 transition-colors cursor-pointer",children:b?"í•´ì„¤ ì ‘ê¸° â†‘":"í•´ì„¤ ë³´ê¸° â†“"}),b&&e.jsx("div",{className:"mt-4 p-6 rounded-xl bg-[var(--color-bg-warm)] dark:bg-[var(--color-dark-surface)] border border-gray-100 dark:border-gray-800",style:{animation:"slideDown 0.3s ease-out"},children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:O(r.explanation)}})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:j,className:"flex-1 py-3 rounded-xl border-2 border-gray-200 dark:border-gray-700 font-semibold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer min-h-[48px]",children:y?"ë§í¬ ë³µì‚¬ë¨!":"ê³µìœ í•˜ê¸°"}),x&&e.jsx("a",{href:`/quiz/${x}`,className:"flex-1 py-3 rounded-xl bg-[var(--color-primary)] text-white font-semibold text-center no-underline hover:bg-[var(--color-primary-dark)] transition-colors min-h-[48px] flex items-center justify-center",children:"ë‹¤ìŒ ë¬¸ì œ â†’"})]}),e.jsxs("div",{className:"flex justify-between mt-8 pt-4 border-t border-gray-100 dark:border-gray-800 text-sm",children:[n?e.jsx("a",{href:`/quiz/${n}`,className:"text-[var(--color-primary)] no-underline",children:"â† ì´ì „ ë¬¸ì œ"}):e.jsx("span",{}),e.jsx("a",{href:"/archive",className:"text-[var(--color-text-secondary)] no-underline",children:"ì „ì²´ ë³´ê¸°"}),x?e.jsx("a",{href:`/quiz/${x}`,className:"text-[var(--color-primary)] no-underline",children:"ë‹¤ìŒ ë¬¸ì œ â†’"}):e.jsx("span",{})]})]})]})}function O(r){return r.replace(/^## (.+)$/gm,'<h2 class="text-lg font-bold mt-4 mb-2">$1</h2>').replace(/^> (.+)$/gm,'<blockquote class="border-l-4 border-[var(--color-primary)] pl-4 py-1 my-3 text-sm bg-purple-50/50 dark:bg-purple-900/10 rounded-r-lg">$1</blockquote>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,'</p><p class="mb-3">').replace(/\n- /g,'</p><li class="ml-4 mb-1">â€¢ ').replace(/\n(\d+)\. /g,'</p><li class="ml-4 mb-1">$1. ')}export{T as default};
