---
import BaseLayout from '../layouts/BaseLayout.astro';
import SampleQuiz from '../components/landing/SampleQuiz';
import { quizzes } from '../lib/quizzes';

const latestQuiz = quizzes[0];
const totalQuizzes = quizzes.length;
---

<BaseLayout title="ë‡Œê°„ì‹">
  <!-- Hero -->
  <section class="relative overflow-hidden bg-gradient-to-b from-[var(--color-bg-warm)] to-[var(--color-bg-light)]">
    <div class="max-w-5xl mx-auto px-4 py-16 sm:py-20 md:py-24 lg:py-32 text-center">
      <div class="text-6xl mb-6">ğŸ§ </div>
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-4">
        ë§¤ì¼ ì•„ì¹¨, <span class="text-[var(--color-primary)]">í•œ ë¬¸ì œ</span>.<br />
        ì¶œê·¼ê¸¸ì— í•œì…ì´ë©´ ë©ë‹ˆë‹¤.
      </h1>
      <p class="text-lg text-[var(--color-text-secondary)] max-w-xl mx-auto mb-8">
        AIê°€ ì—„ì„ í•œ êµì–‘ í€´ì¦ˆ 1ê°œ + ì´ˆë“±í•™ìƒë„ ì´í•´í•˜ëŠ” í•´ì„¤ì„<br class="hidden sm:block" />
        ë§¤ì¼ ì´ë©”ì¼ë¡œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
      </p>
      <form id="hero-subscribe" class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto mb-4">
        <input
          type="email"
          name="email"
          placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
          required
          class="flex-1 px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[var(--color-dark-surface)] text-base focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"
        />
        <button
          type="submit"
          class="px-6 py-3 rounded-xl bg-[var(--color-primary)] text-white font-semibold text-base hover:bg-[var(--color-primary-dark)] transition-colors cursor-pointer min-h-[48px]"
        >
          ë‚´ì¼ë¶€í„° ë°›ê¸°
        </button>
      </form>
      <p class="text-sm text-[var(--color-text-secondary)]">ë¬´ë£Œ Â· ë§¤ì¼ 1í†µ Â· ì–¸ì œë“  êµ¬ë… í•´ì§€</p>
    </div>
  </section>

  <!-- Sample Quiz -->
  <section class="max-w-2xl mx-auto px-4 -mt-8 relative z-10">
    <div class="bg-white dark:bg-[var(--color-dark-surface)] rounded-2xl shadow-lg p-6 sm:p-8 border border-gray-100 dark:border-gray-800">
      <p class="text-sm font-medium text-[var(--color-primary)] mb-2">ì˜¤ëŠ˜ì˜ ë¬¸ì œ, ì§€ê¸ˆ í’€ì–´ë³´ì„¸ìš”</p>
      <SampleQuiz quiz={latestQuiz} client:visible />
    </div>
  </section>

  <!-- How It Works -->
  <section class="max-w-5xl mx-auto px-4 py-20">
    <h2 class="text-2xl font-bold text-center mb-12">ì´ë ‡ê²Œ ë™ì‘í•©ë‹ˆë‹¤</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
      {[
        { step: '1', icon: 'ğŸ“¬', title: 'êµ¬ë…', desc: 'ì´ë©”ì¼ í•˜ë‚˜ë©´ ë. 10ì´ˆ ê°€ì….' },
        { step: '2', icon: 'ğŸ§©', title: 'ë§¤ì¼ ì•„ì¹¨ 8ì‹œ', desc: 'ë¬¸ì œ 1ê°œê°€ ì´ë©”ì¼ë¡œ ë„ì°©.' },
        { step: '3', icon: 'ğŸ’¡', title: '30ì´ˆ í’€ê¸°', desc: 'ì •ë‹µ í™•ì¸ + í•´ì„¤ë¡œ ì§€ì‹ ì¶©ì „.' },
      ].map((item) => (
        <div class="text-center">
          <div class="w-16 h-16 rounded-2xl bg-[var(--color-bg-warm)] flex items-center justify-center text-3xl mx-auto mb-4">
            {item.icon}
          </div>
          <div class="text-xs font-bold text-[var(--color-primary)] mb-1">STEP {item.step}</div>
          <h3 class="font-bold text-lg mb-2">{item.title}</h3>
          <p class="text-sm text-[var(--color-text-secondary)]">{item.desc}</p>
        </div>
      ))}
    </div>
  </section>

  <!-- Social Proof -->
  <section class="bg-[var(--color-bg-warm)] dark:bg-[var(--color-dark-surface)]">
    <div class="max-w-5xl mx-auto px-4 py-16">
      <div class="grid grid-cols-3 gap-4 text-center">
        <div>
          <p class="text-3xl font-bold text-[var(--color-primary)]">{totalQuizzes}+</p>
          <p class="text-sm text-[var(--color-text-secondary)]">ëˆ„ì  ë¬¸ì œ ìˆ˜</p>
        </div>
        <div>
          <p class="text-3xl font-bold text-[var(--color-primary)]">10ê°œ</p>
          <p class="text-sm text-[var(--color-text-secondary)]">ë¶„ì•¼</p>
        </div>
        <div>
          <p class="text-3xl font-bold text-[var(--color-primary)]">ë§¤ì¼</p>
          <p class="text-sm text-[var(--color-text-secondary)]">ìƒˆë¡œìš´ ë¬¸ì œ</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="max-w-2xl mx-auto px-4 py-20">
    <h2 class="text-2xl font-bold text-center mb-10">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h2>
    <div class="space-y-4">
      {[
        { q: 'ì–´ë–¤ ë¶„ì•¼ì˜ ë¬¸ì œê°€ ë‚˜ì˜¤ë‚˜ìš”?', a: 'ê²½ì œ, í•œêµ­ì‚¬, ê³¼í•™, ë²•, ì‹¬ë¦¬, IT, ê±´ê°•, ë¬¸í•™ ë“± 10ê°œ ë¶„ì•¼ì—ì„œ êµì–‘ìœ¼ë¡œ ì¬ë°ŒëŠ” ë¬¸ì œë§Œ ë½‘ìŠµë‹ˆë‹¤.' },
        { q: 'ì •ë§ ë¬´ë£Œì¸ê°€ìš”?', a: 'ë§¤ì¼ 1ë¬¸ì œ + í•´ì„¤ì€ ì™„ì „ ë¬´ë£Œì…ë‹ˆë‹¤. ì‹¬í™” í•´ì„¤ê³¼ ì¶”ê°€ ë¬¸ì œëŠ” í”„ë¦¬ë¯¸ì—„ì—ì„œ ì œê³µë©ë‹ˆë‹¤.' },
        { q: 'ë§¤ì¼ ì•ˆ í’€ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?', a: 'ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§€ë‚œ ë¬¸ì œëŠ” ì•„ì¹´ì´ë¸Œì—ì„œ ì–¸ì œë“  í’€ ìˆ˜ ìˆì–´ìš”.' },
        { q: 'êµ¬ë… í•´ì§€ëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ìš”?', a: 'ëª¨ë“  ì´ë©”ì¼ í•˜ë‹¨ì˜ êµ¬ë… í•´ì§€ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì¦‰ì‹œ í•´ì§€ë©ë‹ˆë‹¤.' },
      ].map((faq) => (
        <details class="group bg-white dark:bg-[var(--color-dark-surface)] rounded-xl border border-gray-100 dark:border-gray-800 p-4 cursor-pointer">
          <summary class="font-semibold flex items-center justify-between list-none">
            <span>{faq.q}</span>
            <svg class="w-5 h-5 text-[var(--color-text-secondary)] transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <p class="mt-3 text-sm text-[var(--color-text-secondary)] leading-relaxed">{faq.a}</p>
        </details>
      ))}
    </div>
  </section>

  <!-- Bottom CTA -->
  <section class="bg-[var(--color-primary)] text-white">
    <div class="max-w-2xl mx-auto px-4 py-16 text-center">
      <h2 class="text-2xl font-bold mb-4">ë‚´ì¼ ì•„ì¹¨, ì²« ë¬¸ì œë¥¼ ë°›ì•„ë³´ì„¸ìš”.</h2>
      <form id="bottom-subscribe" class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
        <input
          type="email"
          name="email"
          placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
          required
          class="flex-1 px-4 py-3 rounded-xl text-[var(--color-text-primary)] bg-white text-base focus:outline-none focus:ring-2 focus:ring-white/50"
        />
        <button
          type="submit"
          class="px-6 py-3 rounded-xl bg-white text-[var(--color-primary)] font-semibold text-base hover:bg-gray-100 transition-colors cursor-pointer min-h-[48px]"
        >
          ë¬´ë£Œë¡œ ì‹œì‘í•˜ê¸°
        </button>
      </form>
    </div>
  </section>
</BaseLayout>

<script>
  document.querySelectorAll('#hero-subscribe, #bottom-subscribe').forEach((form) => {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target as HTMLFormElement);
      const email = formData.get('email') as string;
      if (!email) return;

      const btn = (e.target as HTMLFormElement).querySelector('button')!;
      const originalText = btn.textContent;
      btn.textContent = 'ì²˜ë¦¬ ì¤‘...';
      btn.setAttribute('disabled', 'true');

      try {
        const res = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });
        if (res.ok) {
          btn.textContent = 'í™•ì¸ ì´ë©”ì¼ì„ ë³´ëƒˆì–´ìš”!';
          btn.classList.add('bg-[var(--color-correct)]');
        } else {
          const data = await res.json();
          btn.textContent = data.error || 'ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
          setTimeout(() => { btn.textContent = originalText; btn.removeAttribute('disabled'); }, 2000);
        }
      } catch {
        btn.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
        setTimeout(() => { btn.textContent = originalText; btn.removeAttribute('disabled'); }, 2000);
      }
    });
  });
</script>
